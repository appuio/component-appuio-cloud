= Policy: `organization-projects`

[abstract]
--
Organization Projects
--

[horizontal]
Category:: 
Minimum Kyverno version:: 
Subject:: 
Policy type:: "mutate"
Implementation:: https://github.com/appuio/component-appuio-cloud/tree/master/[]



== Policy Definition

.https://github.com/appuio/component-appuio-cloud/tree/master//tests/golden/defaults/appuio-cloud/appuio-cloud/02_organization_projects.yaml[/tests/golden/defaults/appuio-cloud/appuio-cloud/02_organization_projects.yaml,window=_blank]
[source,yaml]
----
apiVersion: kyverno.io/v1
kind: ClusterPolicy
metadata:
  annotations: {}
  labels:
    app.kubernetes.io/component: appuio-cloud
    app.kubernetes.io/managed-by: commodore
    app.kubernetes.io/name: appuio-cloud
    name: organization-projects
  name: organization-projects
spec:
  background: false
  rules:
    - context:
        - apiCall:
            jmesPath: '@'
            urlPath: /apis/user.openshift.io/v1/users/{{request.object.metadata.annotations."openshift.io/requester"}}
          name: ocpuser
      exclude: {}
      match:
        all:
          - resources:
              annotations:
                openshift.io/requester: ?*
              kinds:
                - Project
      mutate:
        patchStrategicMerge:
          metadata:
            labels:
              +(appuio.io/organization): '{{ocpuser.metadata.annotations."appuio.io/default-organization"}}'
      name: set-default-organization
      preconditions: {}
  validationFailureAction: enforce

----
