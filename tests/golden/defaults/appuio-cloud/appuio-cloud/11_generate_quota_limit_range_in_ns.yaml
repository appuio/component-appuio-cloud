apiVersion: kyverno.io/v1
kind: ClusterPolicy
metadata:
  annotations: {}
  labels:
    app.kubernetes.io/component: appuio-cloud
    app.kubernetes.io/managed-by: commodore
    app.kubernetes.io/name: appuio-cloud
    name: quota-and-limit-range-in-ns
  name: quota-and-limit-range-in-ns
spec:
  rules:
    - generate:
        data:
          spec:
            limits:
              - default:
                  cpu: 200m
                  memory: 200Mi
                defaultRequest:
                  cpu: 100m
                  memory: 100Mi
                max:
                  cpu: '1'
                  memory: 4Gi
                min:
                  cpu: 10m
                  ephemeral-storage: 100Ki
                  memory: 4Mi
                type: Container
        kind: LimitRange
        name: organization
        namespace: '{{request.object.metadata.name}}'
        synchronize: true
      match:
        all:
          - resources:
              kinds:
                - Namespace
              selector:
                matchExpressions:
                  - key: appuio.io/organization
                    operator: Exists
      name: generate-limit-range
    - generate:
        data:
          spec:
            hard:
              limits.cpu: 2
              limits.memory: 20Gi
              pods: '45'
              requests.cpu: 1000m
              requests.memory: 4Gi
            scopes:
              - NotTerminating
        kind: ResourceQuota
        name: organization-compute
        namespace: '{{request.object.metadata.name}}'
        synchronize: true
      match:
        all:
          - resources:
              kinds:
                - Namespace
              selector:
                matchExpressions:
                  - key: appuio.io/organization
                    operator: Exists
      name: generate-quota-organization-compute
    - generate:
        data:
          spec:
            hard:
              limits.cpu: 1000m
              limits.memory: 2Gi
              pods: '5'
            scopes:
              - Terminating
        kind: ResourceQuota
        name: organization-compute-terminating
        namespace: '{{request.object.metadata.name}}'
        synchronize: true
      match:
        all:
          - resources:
              kinds:
                - Namespace
              selector:
                matchExpressions:
                  - key: appuio.io/organization
                    operator: Exists
      name: generate-quota-organization-compute-terminating
    - generate:
        data:
          spec:
            hard:
              count/configmaps: '150'
              count/replicationcontrollers: '100'
              count/secrets: '150'
              count/services: '20'
              count/services.loadbalancers: '0'
              count/services.nodeports: '0'
              limits.ephemeral-storage: 500Mi
              localblock-storage.storageclass.storage.k8s.io/persistentvolumeclaims: '0'
              openshift.io/imagestreams: '20'
              openshift.io/imagestreamtags: '50'
              persistentvolumeclaims: '10'
              requests.ephemeral-storage: 250Mi
              requests.storage: 1000Gi
        kind: ResourceQuota
        name: organization-objects
        namespace: '{{request.object.metadata.name}}'
        synchronize: true
      match:
        all:
          - resources:
              kinds:
                - Namespace
              selector:
                matchExpressions:
                  - key: appuio.io/organization
                    operator: Exists
      name: generate-quota-organization-objects
